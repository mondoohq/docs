## Before you begin

Before you will need the following:

- Super Administrator access to [Google Workspace Admin Console](https://admin.google.com)
- Administrator access to [Google Cloud Console](https://console.cloud.google.com/)

## Create Google Cloud Service account

:::note

These steps for configuring [Admin SDK API](https://developers.google.com/admin-sdk) access to your
Google Workspace environment rely on Google Cloud (GCP) even if you aren't otherwise using GCP.

:::

### Step 1: Create a Google Cloud Project

1. Go to [Google Cloud](https://console.cloud.google.com/) and sign in as a super administrator. If it's your first time signing in to the console, agree to the Terms of Service.
2. Select **IAM & Admin** > **Manage Resources**.
3. At the top, select **Create Project** and enter a project name (i.e. Mondoo Security Scan).
   (Optional) To add the project to a folder, for Location, select Browse, navigate to the folder, and select Select.
4. Select **Create**.

### Step 2: Enable the required APIs to scan Google Workspace

1. From the Google Cloud menu, choose **APIs & Services** > **Library**.
2. For each API you require (below), select the API name and then **Enable**:

   - Admin SDK
   - Google Calendar API
   - Contacts API
   - Gmail API
   - Groups Migration API
   - Cloud Identity API
   - Google Drive API

**Tip:** If you can't find the API, specify the API name in the search box.

### Step 3: Set up the OAuth consent screen

1. Select **APIs & Services** > **OAuth consent screen**.
2. For **User Type**, select **Internal**.
3. Select **Create**.
4. For **App name**, enter "Mondoo Security Scanner" or another name that makes sense for your organization.
5. For **Authorized Domains**, select **+ ADD DOMAIN** and enter your domain configured in Google Workspace.
6. Select a **User support email** for users to contact with questions.
7. For **Developer contact information**, enter email addresses so Google can contact you about changes to your project.
8. Select **Save and Continue** > **Save** and **Continue** > **Back to Dashboard**.

### Step 4: Create the service account

1. Select **APIs & Services** > **Credentials**.
2. Select **Create Credentials** > **Service account**.
3. For **Service account name**, enter "mondoo-security-scanner" or another name that makes sense for your organization.
4. (Optional) For **Service account description**, enter a description of the service account.
5. Select **Create** and **Continue**.
6. Select **Done** > **Save**.
7. At the top, select **Key** > **Add Key** > **Create new key**.
8. Make sure the key type is set to **JSON** and select **Create**. You'll get a message that the service account's private key JSON file was downloaded to your computer. Make a note of the file name and where your browser saves it. You'll need it later.
9. Select **Close**.

![Google Service Account Client ID](/img/platform/infra/saas/gw/gw-service-account-id.png)

After creating the service account, record the **OAuth 2 / Client ID** from the list of service accounts. You will need that for the next step.

## Configure Domain-Wide Delegation in Google Workspace Admin Console

In this next section you will configure **Domain-wide Delegation** in Google Workspace Admin console to allow your service account to access the Google Workspace APIs required by Mondoo.

1. Log into the [Google Workspace Admin Console](https://admin.google.com).
2. In the left-side navigation, select **Security** > **Access and data control** > **API controls**.
3. Select **Domain-wide Delegation** and then select **Add new**.
4. For the **Client ID**, enter the **Client ID** from the last section.
5. For the **OAuth Scopes**, paste the following comma-delimited list to add all 16 read-only OAuth scopes:

   ```text
   https://www.googleapis.com/auth/admin.chrome.printers.readonly,https://www.googleapis.com/auth/admin.directory.customer.readonly,https://www.googleapis.com/auth/admin.directory.device.chromeos.readonly,https://www.googleapis.com/auth/admin.directory.device.mobile.readonly,https://www.googleapis.com/auth/admin.directory.domain.readonly,https://www.googleapis.com/auth/admin.directory.group.member.readonly,https://www.googleapis.com/auth/admin.directory.group.readonly,https://www.googleapis.com/auth/admin.directory.orgunit.readonly,https://www.googleapis.com/auth/admin.directory.resource.calendar.readonly,https://www.googleapis.com/auth/admin.directory.rolemanagement.readonly,https://www.googleapis.com/auth/admin.directory.user.alias.readonly,https://www.googleapis.com/auth/admin.directory.user.readonly,https://www.googleapis.com/auth/admin.directory.userschema.readonly,https://www.googleapis.com/auth/admin.reports.audit.readonly,https://www.googleapis.com/auth/admin.reports.usage.readonly,https://www.googleapis.com/auth/admin.directory.user.security,https://www.googleapis.com/auth/cloud-identity.groups.readonly
   ```

6. Select **Authorize**.

### Super Admin Role email

To use your Google Cloud service account with Domain-Wide Delegation, you need to specify a Super Admin role email to impersonate when authenticating to the API.

In the [Google Workspace Admin Console](https://admin.google.com), navigate to **Account** > **Admin Roles** and select **Super Admins**. Record the email address for the Super Admin you want to use when authenticating.

For more information on Super Admin Roles, see [Prebuilt administrator roles](https://support.google.com/a/answer/2405986) in the Google Workspace documentation.

### Record your Google Workspace Customer ID

After configuring **Domain-wide Delegation** for your service account, navigate to **Account** > **Account Settings** and record the **Customer ID**. You will need the customer ID to configured hosted scanning in Mondoo Platform, or to use with `cnspec` or `cnquery` locally.

![Google Workspace Customer ID](/img/platform/infra/saas/gw/gw-customer-id.png)
